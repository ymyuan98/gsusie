<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Performs a sparse Bayesian variable selection on generalized
linear models using the genaralized sum of single-effects (GSuSiE) model.
This function is currently designed for Poisson and logistic
regression models, where the response y can be a count type or binary
variable. Codes as well as the arguments and descriptions are referred from
https://github.com/stephenslab/susieR/blob/master/R/susie.R.
In brief, this function transforms the GLMs into iterative reweighted
least square problems, and then (at each iteration) tries to find the
regression coefficients \(\beta\) such that the log-likelihood function
\(\ell(X,y|\beta,\nu^2)=-\frac{1}{2}\sum_{i=1}^n\left(\frac{z_i-x_{i.}
\beta}{\nu}\right)^2\) is maximized. Following the &amp;#8220;susie assumptions&amp;#8221;,
\(\beta = \sum_{l=1}^L \beta_l\), where each \(\beta_l\) is a vector of
length p with one non-zero element. The value of \(maxL\) is fixed and
should be a value of the reasonable upper bound on the number of non-zero
effects to be detected."><title>Generalized Sum of Single-effects (GSuSiE) — gsusie • gsusie</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generalized Sum of Single-effects (GSuSiE) — gsusie"><meta property="og:description" content="Performs a sparse Bayesian variable selection on generalized
linear models using the genaralized sum of single-effects (GSuSiE) model.
This function is currently designed for Poisson and logistic
regression models, where the response y can be a count type or binary
variable. Codes as well as the arguments and descriptions are referred from
https://github.com/stephenslab/susieR/blob/master/R/susie.R.
In brief, this function transforms the GLMs into iterative reweighted
least square problems, and then (at each iteration) tries to find the
regression coefficients \(\beta\) such that the log-likelihood function
\(\ell(X,y|\beta,\nu^2)=-\frac{1}{2}\sum_{i=1}^n\left(\frac{z_i-x_{i.}
\beta}{\nu}\right)^2\) is maximized. Following the &amp;#8220;susie assumptions&amp;#8221;,
\(\beta = \sum_{l=1}^L \beta_l\), where each \(\beta_l\) is a vector of
length p with one non-zero element. The value of \(maxL\) is fixed and
should be a value of the reasonable upper bound on the number of non-zero
effects to be detected."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gsusie</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../index.html">Home</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/index.html">Vignettes</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ymyuan98/gsusie">Source</a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Generalized Sum of Single-effects (GSuSiE)</h1>
      <small class="dont-index">Source: <a href="https://github.com/ymyuan98/gsusie/blob/HEAD/R/gsusie.R" class="external-link"><code>R/gsusie.R</code></a></small>
      <div class="d-none name"><code>gsusie.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs a sparse Bayesian variable selection on generalized
linear models using the genaralized sum of single-effects (GSuSiE) model.
This function is currently designed for <em>Poisson</em> and <em>logistic</em>
regression models, where the response y can be a count type or binary
variable. Codes as well as the arguments and descriptions are referred from
<a href="https://github.com/stephenslab/susieR/blob/master/R/susie.R" class="external-link">https://github.com/stephenslab/susieR/blob/master/R/susie.R</a>.
In brief, this function transforms the GLMs into iterative reweighted
least square problems, and then (at each iteration) tries to find the
regression coefficients \(\beta\) such that the log-likelihood function
\(\ell(X,y|\beta,\nu^2)=-\frac{1}{2}\sum_{i=1}^n\left(\frac{z_i-x_{i.}
\beta}{\nu}\right)^2\) is maximized. Following the “susie assumptions”,
\(\beta = \sum_{l=1}^L \beta_l\), where each \(\beta_l\) is a vector of
length p with one non-zero element. The value of \(maxL\) is fixed and
should be a value of the reasonable upper bound on the number of non-zero
effects to be detected.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gsusie</span><span class="op">(</span></span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"binomial"</span>, <span class="st">"poisson"</span><span class="op">)</span>,</span>
<span>  maxL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  prior_inclusion_prob <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  estimate_prior_variance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  estimate_prior_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"optim"</span>, <span class="st">"EM"</span>, <span class="st">"simple"</span><span class="op">)</span>,</span>
<span>  coef_prior_variance <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  check_null_threshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  prior_tol <span class="op">=</span> <span class="fl">1e-09</span>,</span>
<span>  robust_estimation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  robust_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"huber"</span>, <span class="st">"simple"</span>, <span class="st">"bisquare"</span><span class="op">)</span>,</span>
<span>  simple_outlier_fraction <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  simple_outlier_thres <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  robust_tuning_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"S"</span><span class="op">)</span>,</span>
<span>  null_weight <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  coverage <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  min_abs_corr <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max_iters <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  n_purity <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  abnormal_proportion <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  track_fit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>X</dt>
<dd><p>An n by p matrix of covariates.</p></dd>


<dt>y</dt>
<dd><p>The observed responses, a vector of length n.</p></dd>


<dt>family</dt>
<dd><p>A description of error distribution and link function used in
the model. So far, only <em>binomial distributions with logit link</em>
(<code>family="binomial"</code>) and <em>Poisson distributions with log link</em>
(<code>family="poisson"</code>) are developed.</p></dd>


<dt>maxL</dt>
<dd><p>Maximum number of non-zero effects in the gsusie model. By
default, <code>maxL=10</code>. If the number of covariates, <em>p</em>, is greater
than 10, then set <code>maxL=p</code>.</p></dd>


<dt>prior_inclusion_prob</dt>
<dd><p>A vector of length p, in which each entry
gives the prior probability that corresponding column of X has a
nonzero effect on the outcome, y.</p></dd>


<dt>estimate_prior_variance</dt>
<dd><p>Boolean. If <code>TRUE</code>, the coefficient prior
variance is estimated and <code>coef_prior_variance</code> is then used as an
initial value for the optimization (if provided). If <code>FALSE</code>, the prior
variance for each of the <code>maxL</code> effects is fixed and determined by the
value supplied to <code>coef_prior_variance</code>.</p></dd>


<dt>estimate_prior_method</dt>
<dd><p>The method used for estimating prior variance.
When <code>estimate_prior_method="simple"</code> is used, the likelihood at the
specified prior variance is compared to the likelihood at a variance of zero,
and the setting with the larger likelihood is retained.</p></dd>


<dt>coef_prior_variance</dt>
<dd><p>NULL, or a scalar specifying the prior variance
of coefficient, or a vector of length <code>maxL</code>. If it is a scalar, then
this value is consistent in all \(\beta_l\).</p></dd>


<dt>check_null_threshold</dt>
<dd><p>When the prior variance is estimated,
compare the estimated with the null, and set the prior variance to zero
unless the log-likelihood using the estimate is larger by this threshold
amount. For example, if you set <code>check_null_threshold = 0.1</code>,
this will "nudge" the estimate towards zero when the difference in
log-likelihoods is small. A note of caution that setting this to a value
greater than zero may lead the IBSS fitting procedure to occasionally
decrease the ELBO.</p></dd>


<dt>prior_tol</dt>
<dd><p>When the prior variance is estimated, compare the
estimated value to <code>prior_tol</code> at the end of the computation,
and exclude a single effect from PIP computation if the estimated prior
vairnace is smaller than this tolerance value.</p></dd>


<dt>robust_estimation</dt>
<dd><p>If <code>robust_estimation=TRUE</code>,
robust estimation method is applied on the coefficient estimation.</p></dd>


<dt>robust_method</dt>
<dd><p>If <code>robust_method= "simple"</code>,
then the outliers defined by <code>simple_outlier_fraction</code> or
<code>simple_outlier_thres</code> are simply removed in each iteration.
If <code>robust_method="huber"</code>, Huber weights are additionally
multiplied to the pseudo-weights in each iteration.
If <code>robust_method = "bisquare"</code>, (Tukey's) bisquare weights are
additionally multipled to the pseudo-weights in each iteration.</p></dd>


<dt>simple_outlier_fraction</dt>
<dd><p>a value between 0 and 1, indicating the
fraction of outliers: we define the
<code>simple_outlier_fraction</code> percent of subjects with the highest
absolute values (inverse of pseudo-variance) as outliers.
By default, <code>simple_outlier_fraction=NULL</code> does not set any outlier
fraction. Either <code>simple_outlier_fraction</code> or
<code>simple_outlier_thres</code> should be specified when
<code>robust_method = "simple"</code>.</p></dd>


<dt>simple_outlier_thres</dt>
<dd><p>a real value, indicating the outliers whose
inverse of pseudo-variance exceed this threshold to be removed from the
current iteration. Either <code>simple_outlier_fraction</code> or
<code>simple_outlier_thres</code> should be specified when
<code>robust_method = "simple"</code>.</p></dd>


<dt>robust_tuning_method</dt>
<dd><p>If <code>robust_tuning_method = "M"</code>,
M-estimation is performed. If <code>robust_tuning_method = "S"</code>,
S-estimation is performed. This argument specifies the tuning method,
i.e., the method for defining outliers in each iteration, when applying
Huber or Bisquare reweighting method (<code>robust_method = "huber"</code> or
<code>robust_method = "bisquare"</code>).</p></dd>


<dt>null_weight</dt>
<dd><p>Prior probability of no effect (a number between
0 and 1, and cannot be exactly 1).</p></dd>


<dt>standardize</dt>
<dd><p>If <code>standardize = TRUE</code>, standardize the
columns of X to unit variance prior to fitting (or equivalently
standardize XtX and Xty to have the same effect).
Any column of <code>X</code> that has zero variance is not standardized.</p></dd>


<dt>coverage</dt>
<dd><p>A number between 0 and 1 specifying the
“coverage” of the estimated confidence sets.</p></dd>


<dt>min_abs_corr</dt>
<dd><p>Minimum absolute correlation allowed in a
credible set. The default, 0.5, corresponds to a squared
correlation of 0.25, which is a commonly used threshold for
genotype data in genetic studies.</p></dd>


<dt>max_iters</dt>
<dd><p>Maximum number of iterations.</p></dd>


<dt>na.rm</dt>
<dd><p>Drop any missing values in y from both X and y.</p></dd>


<dt>tol</dt>
<dd><p>A small, non-negative number specifying the convergence
tolerance for the IBSS fitting procedure. The fitting procedure
will halt when the difference in the variational lower bound, or
“ELBO” (the objective function to be maximized), is
less than <code>tol</code>.</p></dd>


<dt>n_purity</dt>
<dd><p>Passed as argument <code>n_purity</code> to <code>gsusie_get_cs</code>.</p></dd>


<dt>abnormal_proportion</dt>
<dd><p>A value between 0 and 1. Abnormal data point
may arise when transforming the GLM into (iterative re)weighted least square
problems. Currently, the abnormal points are data points whose
pseudo-variances or pseudo-responses are Inf or NAN. If an abnormal point
is detected, it is removed from the current iteration.
If the number of detected abnormal subjects exceeds
<code>abnormal_proportion * nrow(X)</code>, stop fitting the model.</p></dd>


<dt>track_fit</dt>
<dd><p>If <code>track_fit=TRUE</code>, <code>trace</code> is also returned
containing detailed information about the estimates at each iteration of the
IBSS fitting procedure.</p></dd>


<dt>verbose</dt>
<dd><p>If <code>verbose=TRUE</code>, the algorithm's progress, and a
summary of the optimization settings, are printed to the console.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <code>"gsusie"</code> object with some or all of the following elements:</p>
<dl><dt>alpha</dt>
<dd><p>A <code>maxL</code> by p matrix of posterior inclusion probabilities.</p></dd>


<dt>mu</dt>
<dd><p>A <code>maxL</code> by p matrix of posterior means, conditional on
inclusion.</p></dd>


<dt>mu2</dt>
<dd><p>A <code>maxL</code> by p matrix of posterior second moments, conditional
on inclusion.</p></dd>


<dt>lbf</dt>
<dd><p>Log-Bayes Factor for each single effect.</p></dd>


<dt>lbf_variable</dt>
<dd><p>Log-Bayes Factor for each variable and single effect.</p></dd>


<dt>family</dt>
<dd><p>A generalized linear model family, either “binomial” or
“poisson”.</p></dd>


<dt>Xr</dt>
<dd><p>A vector of length n, equal to <code>X %*% colSums(alpha
  * mu)</code>.</p></dd>


<dt>V</dt>
<dd><p>Prior variance of the non-zero elements of \(\beta\).</p></dd>


<dt>converged</dt>
<dd><p><code>TRUE</code> or <code>FALSE</code> indicating whether the IBSS
converged to a solution within the chosen tolerance level.</p></dd>


<dt>elbo</dt>
<dd><p>The value of variational lower bound, or “ELBO”, achieved
at each iteration of the IBSS fitting procedure.</p></dd>


<dt>loglik_exact</dt>
<dd><p>The value of exact log-likelihood function of the GLM.</p></dd>


<dt>loglik_apprx</dt>
<dd><p>The value of approximated log-likelihood function of the
weighted least square model transformed from the corresponding GLM.</p></dd>


<dt>niter</dt>
<dd><p>Number of IBSS iterations that were performed.</p></dd>


<dt>sets</dt>
<dd><p>Credible sets estimated from model fit.</p></dd>


<dt>pip</dt>
<dd><p>A vector of length p giving marginal posterior inclusion
probabilities for all p covariates.</p></dd>


<dt>X_column_scale_factor</dt>
<dd><p>A vector of length p giving the scale factor of
each column.</p></dd>


<dt>X_column_center_factor</dt>
<dd><p>A vector of length p giving the center factor
of each column</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>To fit GSuSiE on a Poisson regression model, it is recommended to
perform robust estimation. The robust estimation helps address the
potential negative effect of outliers especially in count data.
M/S-estimation with Huber weights is suggested (by setting
<code>robust_estimation=TRUE</code>, <code>robust_method="huber"</code>, and
<code>robust_tuning_method="M"</code>.
To fit GSuSiE on a logistic regression model, it is recommended not to
perform robust estimation (by default <code>robust_estimation=FALSE</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>G. Wang, A. Sarkar, P. Carbonetto and M. Stephens (2020). A simple
new approach to variable selection in regression, with application
to genetic fine-mapping. <em>Journal of the Royal Statistical
Society, Series B</em> <b>82</b>, 1273-1300 <a href="https://doi.org/10.1101/501114" class="external-link">doi:10.1101/501114</a>
.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## A Poisson regression case ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20231130</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generative data model</span></span></span>
<span class="r-in"><span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">pp</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nn</span> <span class="op">*</span> <span class="va">pp</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">pp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">nn</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       Sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span><span class="op">[</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">nn</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       Sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.6</span>, <span class="fl">0.9</span>,</span></span>
<span class="r-in"><span>                                        <span class="fl">0.6</span>, <span class="fl">1</span>, <span class="fl">0.75</span>,</span></span>
<span class="r-in"><span>                                        <span class="fl">0.9</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                       nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">effect_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Eta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="va">effect_idx</span>, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Eta</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Vanilla G-SuSiE</span></span></span>
<span class="r-in"><span><span class="co"># res_gs &lt;- gsusie(cbind(X, 1), y, family = "poisson")</span></span></span>
<span class="r-in"><span><span class="va">res_gs</span> <span class="op">&lt;-</span> <span class="fu">gsusie</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">X</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res_gs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="print_gsusie_coefficients.html">print_gsusie_coefficients</a></span><span class="op">(</span><span class="va">res_gs</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Robust G-SuSiE for Poisson regression</span></span></span>
<span class="r-in"><span><span class="co"># res_gs &lt;- gsusie(cbind(X, 1), y, family = "poisson",</span></span></span>
<span class="r-in"><span><span class="co">#                 robust_estimation = TRUE, robust_method = "huber",</span></span></span>
<span class="r-in"><span><span class="co">#                 robust_tuning_method = "M")</span></span></span>
<span class="r-in"><span><span class="va">res_gs</span> <span class="op">&lt;-</span> <span class="fu">gsusie</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">X</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"poisson"</span>,</span></span>
<span class="r-in"><span>                 robust_estimation <span class="op">=</span> <span class="cn">TRUE</span>, robust_method <span class="op">=</span> <span class="st">"huber"</span>,</span></span>
<span class="r-in"><span>                 robust_tuning_method <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res_gs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="print_gsusie_coefficients.html">print_gsusie_coefficients</a></span><span class="op">(</span><span class="va">res_gs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## A logistic regression case -----------------------------------------------</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#' set.seed(20240103)</span></span></span>
<span class="r-in"><span><span class="co"># Generative data model</span></span></span>
<span class="r-in"><span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">pp</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nn</span> <span class="op">*</span> <span class="va">pp</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">pp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">effect_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Eta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="va">effect_idx</span>, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">bb</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">expit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eta</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">eta</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span>, <span class="fu"><a href="expit.html">expit</a></span><span class="op">(</span><span class="va">Eta</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Vanilla GSuSiE for logistic regression</span></span></span>
<span class="r-in"><span><span class="va">res_gs</span> <span class="op">&lt;-</span> <span class="fu">gsusie</span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res_gs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="print_gsusie_coefficients.html">print_gsusie_coefficients</a></span><span class="op">(</span><span class="va">res_gs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ming Yuan.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

